#SET{reservations,#ARRAY}
[(#ENV{multiple}|oui)#SET{totale,#ARRAY}]

#SET{objets,#VAL|lister_tables_objets_sql}

<BOUCLE_status(DATA){source tableau,#GET{objets}|table_valeur{spip_reservations}|table_valeur{statut_textes_instituer}}{si #ENV{multiple}|oui}>
    #SET{#CLE,#ARRAY}
</BOUCLE_status>

<BOUCLE_reservations(RESERVATIONS_DETAILS){id_evenement IN #ENV{id_evenement}}{statut ?}>
    [(#ENV{multiple}|non)
     #SET{reservations,#GET{reservations}|push{#QUANTITE}}   
    ]
    [(#ENV{multiple}|oui)
        [(#SET{#STATUT,#GET{#STATUT}|push{#QUANTITE}})]
         #SET{totale,#GET{totale}|push{#QUANTITE}} 
        [(#SET{reservations,#GET{reservations}|array_merge{#ARRAY{#STATUT,#GET{#STATUT}|array_sum}}}) ]       
    ]
</BOUCLE_reservations>
[(#ENV{multiple}|non)
    [(#GET{reservations}|array_sum)]
]
[(#ENV{multiple}|oui)
    [(#GET{reservations}|array_merge{#ARRAY{totale,#GET{totale}|array_sum}}|array_reverse|serialize)]
]